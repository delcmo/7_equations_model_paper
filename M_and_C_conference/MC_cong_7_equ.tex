%%
%% This is file `elsarticle-template-num.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% elsarticle.dtx  (with options: `numtemplate')
%% 
%% Copyright 2007, 2008 Elsevier Ltd.
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% -------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 

%% Template article for Elsevier's document class `elsarticle'
%% with numbered style bibliographic references
%% SP 2008/03/01

%\documentclass[preprint,12pt]{elsarticle}
\documentclass[preprint,10pt]{elsarticle}
%\documentclass[final,3p,times]{elsarticle} 

%% Use the option review to obtain double line spacing
%% \documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times]{elsarticle}
%% \documentclass[final,1p,times,twocolumn]{elsarticle}
%% \documentclass[final,3p,times]{elsarticle}
%% \documentclass[final,3p,times,twocolumn]{elsarticle}
%% \documentclass[final,5p,times]{elsarticle}
%% \documentclass[final,5p,times,twocolumn]{elsarticle}
%
\input{inputs/packages.tex}
%
\input{inputs/def.tex}
%
\journal{Journal of Comp. Phys.}
%
\bibliographystyle{elsarticle-num}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%   BEGIN DOCUMENT
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%
\begin{frontmatter}
%-------------------------
%-------------------------
\title{Simulation of single and two-phase flow water-hammers with the system code Relap-7}
%-------------------------
%-------------------------
\author{Marc O. Delchini\fnref{label1}}
\ead{delchmo@tamu.edu}

\author{Jean C. Ragusa\corref{cor1}\fnref{label1}}
\ead{jean.ragusa@tamu.edu}

\author{Ray A. Berry\fnref{label2}}
\ead{ray.berry@inl.gov}

\address[label1]{Department of Nuclear Engineering, Texas A\&M University, College Station, TX 77843, USA \fnref{label1}}

\address[label2]{Idaho National Laboratory, Idaho Falls, ID 83415, USA \fnref{label2}}

\cortext[cor1]{Corresponding author}
%-------------------------
%-------------------------
%-------------------------
\begin{abstract}
%The RELAP-7 (Reactor Excursion and Leak Analysis Program) code is the next generation
%nuclear reactor system safety analysis code being developed at Idaho National Laboratory
%(INL). The code is based on the INLÕs modern scientific software development framework
%MOOSE (Multi-Physics Object Oriented Simulation Environment) that uses a \emph{Continuous Galerkin Finite Element Method}.
The primary basis of the RELAP-7 governing theory includes the single-phase Euler equations and the 7-equation two-phase flow models. It is well established that these hyperbolic conservation laws can develop shocks and discontinuities and thus, require a stabilization numerical method. The all-Mach flow Entropy Viscosity Method is now employed in RELAP-7 as a stabilization numerical method for both above flow models. The entropy viscosity technique is a viscous regularization technique that satisfies the entropy minimum principle; adequate dissipation terms (viscous fluxes) are added to the governing laws while ensuring the entropy minimum principle still holds. Viscosity coefficients modulates the magnitude of the added dissipation such that it is large in shock regions and vanishingly small elsewhere. We are presenting numerical results of 1-D single and two-phase water-hammers obtained with RELAP-7.
\end{abstract}
%-------------------------
%-------------------------
\begin{keyword}
  RELAP-7 \sep numerical method \sep entropy viscosity method \sep low-Mach flow \sep shocks \sep single phase flow \sep two-phase flow.
\end{keyword}
%-------------------------
\end{frontmatter}
\linenumbers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}\label{sec:intro}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
The RELAP-7 (Reactor Excursion and Leak Analysis Program) code is the next generation
nuclear reactor system safety analysis code being developed at Idaho National Laboratory
(INL). The code is based on the INLÕs modern scientific software development framework
MOOSE (Multi-Physics Object Oriented Simulation Environment) \cite{MOOSE} that uses a \emph{Continuous Galerkin Finite Element Method}.

The primary basis of the RELAP-7 governing theory includes the single-phase Euler equations \cite{Toro} and the 7-equation two-phase flow models \cite{SEM}. It is well established that these hyperbolic conservation laws can develop shocks and discontinuities \cite{Leveque} and thus, require a stabilization numerical method. In the case of the single-phase Euler equations, numerous numerical methods are available both for discontinuous and continuous schemes \cite{Toro, Lapidus_paper, LMP, Lapidus_book, Roe}. The 7-equation model is currently discretized in space using discontinuous schemes with approximate Riemann solvers derived from the well-established approaches for single-phase flows, while using an upwind-type flux for the non-conservative terms \cite{Saurel_2001a, Saurel_2001b, Li_2004, Zein_2010, Ambroso_2012}. In RELAP-7, stabilization of the above conservation laws is ensured by the Entropy Viscosity Method \cite{jlg1, jlg2} that is independent of the type of spatial discretization (finite volume, continuous or discontinuous finite elements, ...) and thus may be applied ubiquitously.
 
The entropy viscosity technique \cite{jlg1, jlg2} is a viscous regularization technique that satisfies the entropy minimum principle; adequate dissipation terms (viscous fluxes) are added to the governing laws while ensuring the entropy minimum principle still holds. Viscosity coefficients modulates the magnitude of the added dissipation such that it is large in shock regions and vanishingly small elsewhere. The entropy viscosity coefficients are taken proportional to the entropy production while, at the same time, being bounded from above by a first-order viscosity coefficient that reduces the spatial discretization to be similar to a first-order Godunov scheme (the latter being known to be overly dissipative but monotone [12]). Hence, entropy production in shocks will result in large viscosity coefficients and thus will avoid spurious oscillations. In order to solve for low-Mach flows \cite{LowMach1, LowMach2, LowMach3}, the initial version of the Entropy Viscosity Method was modified and new definitions of the viscosity coefficients were proposed to ensure well-scaled dissipative terms in the low-Mach asymptotic limit while preserving the capabilities of the method to resolve shocks and discontinuities \cite{Marco_dissertation, Marco_paper_low_mach}. The same approach was used when extending the method to the 7-equation two-phase flow model \cite{Marco_paper_7_equ, Marco_dissertation}. 

In this paper, the regularized single and two-phase flow models are recalled along with the all-Mach flow definitions of the viscosity coefficients in \sct{sct:model}. After detailing the spatial and temporal discretization method in \sct{sec:disc}, numerical results of a single and a two-phase water-hammers are presented in \sct{sec:results}. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Single phase and two-phase flow models}\label{sct:model}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
In this section, the single and the two-phase flow models implemented in Relap-7 are recalled along with the viscous regularization and the all-Mach flows definition of the viscosity coefficients used in the application of the numerical method called the Entropy Viscosity Method (EVM). 
%
%------------------------------------------------------------------------------------------------------------------
\subsection{1-D Euler equations with viscous regularization}\label{sec:single-model}
%------------------------------------------------------------------------------------------------------------------
The conservative form of the 1-D Euler equations \cite{Toro} is implemented in Relap-7 \cite{Relap-7} and used to simulate single-phase flows in 1-D components. An equation of state function of the density, $\rho$ and the specific internal energy $e$, serves as a closure relation to compute the pressure, $P = eos(\rho, e)$. Stabilization of the scheme is ensured by the Entropy Viscosity Method \cite{jlg1, jlg2} that is now designed to be an all-Mach flow numerical method \cite{Marco_paper_low_mach, Marco_dissertation}. The 1-D Euler equations with the viscous regularization and the definition of the viscosity coefficients used in the application of the EVM and implemented in Relap-7, are recalled in \eqt{eq:euler-eq}. The viscous regularization terms are denoted by the dissipative flux $\mbold D$ in the right hanside.
%
\begin{subequations}\label{eq:euler-eq}
\begin{equation}
\partial_t \mbold U + \partial_x \mbold F \left( \mbold U \right) = \partial_x \mbold D \left( \mbold U \right) \, ,
\end{equation}
\text{where}
\begin{equation}
\mbold U = \left[ 
\begin{array}{lll}
&\rho \\
&\rho u \\
&\rho E  \\
\end{array}
\right], \,
%
\mbold F \left( \mbold U \right) = \left[ 
\begin{array}{lll}
&\rho u \\
&\rho u^2 + P \\
&u \left( \rho E + P \right)  \\
\end{array}
\right]
\end{equation}
\text{and}
\begin{equation}
\mbold D \left( \mbold U \right) = \left[ 
\begin{array}{lll}
& f \\
& g + uf \\
& h + ug - 0.5 u^2 f \\
\end{array}
\right]\, , 
\end{equation}
\end{subequations}
%
where $E$ and $u$ are the specific total energy and the velocity fluid, respectively. The partial derivatives with respect to time and space are denoted by $\partial_t$ and $\partial_x$, respectively. Expression of the dissipative terms $f$, $g$ and $h$ was obtained from deriving the entropy residual and applying the entropy minimum principle \cite{jlg}:
%
\begin{equation}
f = \kappa \partial_x \rho , \, g = \mu \rho \partial_x u \text{ and } h = \kappa \partial_x \left( \rho e \right) \, , \nonumber
\end{equation}
%
Definitions of the viscosity coefficients $\mu$ and $\kappa$, given later in \eqt{eq:single-visc-def}, were investigated in \cite{Marco_paper_low_mach} from the non-dimensionalized Euler equations in order to have well-scaled dissipative terms in the case of supersonic and low-Mach flows. Each viscosity coefficient is computed from an upper bound denoted by the subscript $max$, and a second-order viscosity coefficient denoted by the subscript $e$. The upper bound viscosity coefficient is defined proportional to the maximum eigenvalue and is designed to be over-dissipative (\eqt{eq:visc-def-max}). The high-order viscosity coefficient is set proportional to the entropy residual, $R_e(x,t)$ and a jump denoted by $J$. The entropy residual is known to be peaked in the shock region \cite{Leveque} and thus can be used to track shocks. As proposed in \cite{Marco_paper_low_mach} and recalled in \eqt{eq:ent-res}, the entropy residual is locally computed from the pressure, the density and the sound speed, $c$.
%
\begin{equation}\label{eq:ent-res}
R_e(x,t) = \frac{DP}{Dt} - c^2\frac{D\rho}{Dt} \, ,
\end{equation}
%
where $\frac{D (\cdot)}{Dt}$ is the material derivative. The jump $J$ is function of the the jump of pressure and density gradients across the face shared by two cells of the mesh and its definition is given in \eqt{eq:jump}:
%
\begin{equation}\label{eq:jump}
J = \max \left( |u| [[ \partial_x P ]], \, |u| c^2 [[ \partial_x \rho ]] \right) \, ,
\end{equation}
%
where $[[ x ]]$ denotes the jump of the quantity $x$ across a face. The all-Mach flow definition of the viscosity coefficients $\mu$ and $\kappa$ proposed in \cite{Marco_paper_low_mach} is now recalled:
%
\begin{subequations}\label{eq:single-visc-def}
\begin{align}
\mu(x,t) = \min \left( \mu_{max}(x,t), \, \mu_e(x,t) \right) \text{ and } \kappa(x,t) = \min \left( \kappa_{max}(x,t), \, \kappa_e(x,t) \right) \nonumber
\end{align}
\text{where}
\begin{align}\label{eq:visc-def-max}
\mu_{max}(x,t) = \kappa_{max}(x,t) = 0.5 h \left( |u| + c \right)\, ,
\end{align}
\begin{align}\label{eq:visc-def-ent}
\mu_e(x,t) = \frac{h^2}{\norm_\mu} \max \left( R_e(x,t), J \right)\, ,
\kappa_e(x,t) = \frac{h^2}{\rho c^2} \max \left( R_e(x,t), J \right)
\end{align}
\text{and}
\begin{equation}
\norm_\mu = a(M) \rho u^2 + (1-a(M) ) \rho c^2\, 
\end{equation}
\end{subequations}
%
where $h$ is the grid size. The normalization parameter $\norm_\mu$ in the definition of the high-order viscosity coefficient $\mu_e$ is function of the Mach number $M$ through the function $a(M)$. In Eq.  28 of \cite{Marco_paper_low_mach}, an expression for $a(M)$ is proposed and used in this paper as well.
%
%------------------------------------------------------------------------------------------------------------------
\subsection{1-D Seven-Equation two-phase flow model with viscous regularization}\label{sec:two-phase-model}
%------------------------------------------------------------------------------------------------------------------
%
The system code Relap-7 employs the 1-D Seven-equation two-phase flow model \cite{SEM} to simulate the behavior of two-phase flows in Light Water Reactors. In this model, each phase is treated as being compressible, exhibits independent thermodynamic and mechanical properties, and is described by its own equation of state $P_k = eos_k(\rho_k,e_k)$, $k$ being the phase index. This system of equations is hyperbolic and has seven real eigenvalues. The 1-D Seven-equation model is recalled in \eqt{eq:sem-eq} for a liquid phase in interaction with a gas phase denoted by the subscript $liq$ and $gas$, respectively. Equations for the vapor phase can be devised from \eqt{eq:sem-eq} by simply substituting the subscript $_{liq}$ to $_{gas}$ and $_{gas}$ to $_{liq}$.
%
%
\begin{subequations}\label{eq:sem-eq}
\begin{equation}
\partial_t \mbold U_{liq} + \partial_x \mbold F \left( \mbold U_{liq} \right) = \mbold N \left( \mbold U_{liq}, \, \mbold U_{gas} \right) + \mbold R \left( \mbold U_{liq}, \, \mbold U_{gas} \right) +  \partial_x \mbold D \left( \mbold U_{liq} \right) \, ,
\end{equation}
\text{where}
%
\begin{equation}
\mbold U_{liq} = \left[ 
\begin{array}{lll}
& \alpha_{liq} \\
&( \alpha \rho )_{liq} \\
&( \alpha \rho u )_{liq} \\
&( \alpha \rho E )_{liq}  \\
\end{array}
\right], \,
%
\mbold F \left( \mbold U_{liq} \right) = \left[ 
\begin{array}{lll}
& 0 \\
&( \alpha \rho u )_{liq} \\
&( \alpha \rho u^2 + \alpha P )_{liq} \\
&( \alpha u )_{liq} \left( \rho E + P \right)_{liq}  \\
\end{array}
\right]_{liq}, \,
\end{equation}
%
\begin{equation}
\mbold N \left( \mbold U_{liq}, \, \mbold U_{gas} \right) = \left[ 
\begin{array}{lll}
& - u_{int} \partial_x \alpha_{liq} \\
& 0 \\
&P_{int} \partial_x \alpha_{liq} \\
&P_{int} u_{int} \partial_x \alpha_{liq}  \\
\end{array}
\right], \,
\end{equation}
%
\begin{equation}
\mbold R \left( \mbold U_{liq}, \, \mbold U_{gas} \right) = \left[ 
\begin{array}{lll}
& \mu_P \left( P_{gas} - P_{liq} \right) \\
& 0 \\
& \mu_P \left( P_{gas} - P_{liq} \right) \\
& \mu_P \left( P_{gas} - P_{liq} \right) + \lambda_u \left( u_{liq} - u_{gas} \right) \\
\end{array}
\right], \,
\end{equation}
%
\text{and}
\begin{equation}\label{eq:diss-terms}
\mbold D\left( \mbold U_{liq} \right) = \left[ 
\begin{array}{lll}
& l_{liq} \\
& ( f + \rho l )_{liq} \\
& ( g + uf + \rho u l)_{liq} \\
& ( h + ug + 0.5 u^2 f + \rho E l)_{liq} \\
\end{array}
\right] \, , 
\end{equation}
\end{subequations}
%
The liquid void fraction is denoted by  $\alpha_{liq}$ and the vapor void fraction is computed from the algebraic relation $\alpha_{vap} = 1 - \alpha_{liq}$. Following \cite{SEM}, the interfacial variables are function of the liquid and vapor thermodynamic, the mechanical properties and the acoustic impedance denoted by $Z_k = \rho_k c_k$ with $k = \{ liq, \ vap \}$, and computed with the following expressions:
%
\begin{subequations}
\label{eq:int_variables_def}
\begin{align}
  \label{E-R:83}
  P_{int} &= \bar{P}_{int} + \frac{Z_{liq}Z_{vap}}{Z_{liq}+Z_{vap}} sgn \left( \partial_x \alpha_{liq} \right) \cdot (\mbold u_{vap}-\mbold u_{liq}) \,,
  \\
  \bar{P}_{int} &= \frac{Z_{vap} P_{liq}+Z_{liq}P_{vap}}{Z_{liq}+Z_{vap}} \,,
 \\
  \label{E-R:84}
  \mbold u_{int} &= \bar{\mbold u}_{int} +  sgn \left( \partial_x \alpha_{liq}\right) \frac{P_{vap}-P_{liq}}{Z_{liq}+Z_{vap}} \,,
  \\
  \bar{\mbold u}_{int} &= \frac{Z_{liq} \mbold u_{liq}+Z_{vap}\mbold u_{vap}}{Z_{liq}+Z_{vap}} \, ,
\end{align}
\end{subequations}
%
where the function $sgn(x)$ returns the sign of the variable $x$. All other variables were previously defined. Alike for Euler equations (\sct{sec:single-model}), the dissipative terms given in the vector $\mbold D\left( \mbold U_{liq} \right)$ were derived from the entropy minimum principle and have the following definitions:
%
\begin{multline}
l_{liq} = \beta_{liq} \partial_x \alpha_{liq} , \, f_{liq}= ( \alpha \kappa )_{liq} \partial_x \rho_{liq} , \\ g_{liq} = ( \alpha \mu \rho )_{liq} \partial_x u_{liq} \, \text{ and } h_{liq} = ( \alpha \kappa )_{liq} \partial_x \left( \rho e \right)_{liq} \, , \nonumber
\end{multline}
%
where $\beta_{liq}$, $\mu_{liq}$ an $\kappa_{liq}$ are positive viscosity coefficients for the liquid phase and were defined by investigating the non-dimensionalized 7-equation two-phase flow model and performing a low-Mach asymptotic limit \cite{Marco_paper_7_equ}. The viscosity coefficients $\mu_{liq}$ and $\kappa_{liq}$ were found identical to the one given in \eqt{eq:single-visc-def} for the single-phase Euler equation (this is expected since the 7-equation model degenerates to Euler equations when one phase disappears). The approach to define the viscosity coefficient $\beta_{liq}$ is similar to the logic followed for hyperbolic scalar equations \cite{jlg1, jlg2}: an entropy equation can be derived from the volume fraction equation and used in the definition of the viscosity coefficient $\beta_{liq}$ . Following the work by Guermond et al. \cite{jlg1, jlg2}, one obtains:
%
\begin{subequations}
\begin{equation}
\beta_{liq}(x,t) = \max \left( \beta_{max, liq}(x,t), \, \beta_{e, liq}(x,t) \right)
\end{equation}
%
\text{with}
%
\begin{equation}
\beta_{max, liq}(x,t) = 0.5 h | u_{int}(x,t) |
\end{equation}
%
\text{and}
%
\begin{equation}
\beta_{e,liq}(x,t) =  h^2 \frac{\max \left( | R_{\alpha,liq}(x,t) |, J_{\alpha_{liq}} \right)}{|| \alpha_{liq} - \bar{\alpha}_{liq}||_\infty},
\end{equation}
where the entropy residual associated to the volume fraction equation is:
\begin{equation}
\label{eq:beta_def}
R_{\alpha,liq}(x,t) =   \frac{1}{2} \left( \frac{\partial \alpha_{liq}^2}{\partial t} + u_{int} \frac{\partial \alpha_{liq}^2}{\partial x} \right) \, ,
\end{equation} 
\end{subequations}
% 
and $J_{\alpha_{liq}}$ denotes the inter element jump of the gradient of the volume fraction. $\bar{\alpha}_{liq}$ is the average value of the liquid void fraction over the entire computational domain.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spatial and Temporal Discretizations} \label{sec:disc}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
In this section, we briefly describe the spatial and temporal discretizations and the solution techniques 
used to solve the system of equations presented in \sct{sec:single-model} and \sct{sec:two-phase-model}. The two system of 
equations can be recast under the following form for conciseness:
\begin{equation}
\label{eq:form}
\partial_t \mathbf{U} + \div \mathbf{F} \left( \mathbf{U} \right) = \mathbf{R} \left( \mathbf{U} \right) + \mathbf{N} \left( \mathbf{U} \right) + \div \mathbf{D} (\mathbf{U}) \grad \mathbf{U}
\end{equation}
where $\mathbf{U}$ is the solution vector, $\mathbf{F}$ denotes the inviscid flux, $\div D (\mathbf{U}) \grad \mathbf{U}$ is the dissipative flux and $\mathbf{N} \left( \mathbf{U} \right)$ and $\mathbf{R} \left( \mathbf{U} \right)$ contain the non-conservative and relaxation terms. The terms $\mathbf{N} \left( \mathbf{U} \right)$ and $\mathbf{R} \left( \mathbf{U} \right)$ only appear in the two-phase flow model described in \sct{sec:two-phase-model}. 
%
%===================================================================================================
\subsection{Spatial and Temporal Discretizations} \label{sec:spatial-disc}
%===================================================================================================
%
The system of equations given in \eqt{eq:form} is discretized using a continuous Galerkin finite element 
method and temporal integrators available through the MOOSE multiphysics framework \cite{MOOSE}.
%
%---------------------------------------------------------------------------------------------------
\subsubsection{Continuous Finite Elements} 
%---------------------------------------------------------------------------------------------------
%
In order to apply the continuous finite element method, \eqt{eq:form} is multiplied by a test function 
$\mathbf W(\vec{r})$, integrated by parts and each integral is decomposed into a sum of integrals over 
each element $K$ of the discrete mesh $\Omega$. The following weak form is obtained:
\begin{multline}\label{eq:cfem}
\sum_K \int_{K} \partial_t \mathbf U \, \mathbf W - \sum_K \int_{K} \vec{\mathbf F}(\mathbf U) \cdot \grad \mathbf W + \int_{\partial \Omega} \vec{\mathbf F}(\mathbf U) \cdot \vec{n} \, \mathbf W - \sum_K \int_{K} \mathbf S \, \mathbf W  \\
+ \sum_K \int_{K} D(\mathbf U) \grad \mathbf U \cdot \grad \mathbf W 
- \int_{\partial \Omega} D(\mathbf U) \grad \mathbf U \cdot \vec{n} \, \mathbf W = 0 \,.
\end{multline}
The integrals over the elements $K$ are evaluated using a numerical quadrature rule. The MOOSE framework 
provides a wide range of test functions and quadrature rules. Linear Lagrange polynomials are employed 
as test functions in the results section.
%
%---------------------------------------------------------------------------------------------------
\subsubsection{Temporal integration} 
%---------------------------------------------------------------------------------------------------
%
The MOOSE framework offers both first- and second-order explicit and implicit temporal integrators. 
In all of the numerical examples presented in \sct{sec:results}, the temporal derivative  will be 
evaluated using the second-order, backward difference temporal integrator BDF2. By considering three 
consecutive solutions, $\mathbf U^{n-1}$, $\mathbf U^n$ and $\mathbf U^{n+1}$, at times $t^{n-1}$, $t^n$ and $t^{n+1}$, respectively, BDF2 can be expressed as:
\begin{equation}
\label{eq:BDF2}
\int_{K} \partial_t \mathbf U \, \mathbf  W = \int_{K} \left( \omega_0 \mathbf U^{n+1}  + \omega_1 \mathbf U^n + \omega_2 \mathbf U^{n-1} \right) \mathbf W \,,
\end{equation}
with
\begin{multline}
\omega_0 =\frac{2\Delta t^{n+1}+\Delta t^n}{\Delta t^{n+1} \left( \Delta t^{n+1}+\Delta t^n \right)} \, , \ 
\omega_1 = -\frac{\Delta t^{n+1}+\Delta t^n}{\Delta t^{n+1} \Delta t^n}  \, , \\
\text{ and } \omega_2 = \frac{\Delta t^{n+1}}{\Delta t^n \left( \Delta t^{n+1} + \Delta t^n \right)} \nonumber
\end{multline}
where $\Delta t^{n} = t^n-t^{n-1}$ and $\Delta t^{n+1} = t^{n+1}-t^{n}$.
%
%---------------------------------------------------------------------------------------------------
\subsection{Boundary conditions} \label{sec:bc}
%---------------------------------------------------------------------------------------------------
%
Boundary conditions are implemented by performing a characteristic decomposition to compute the 
appropriate flux at the boundaries in Relap-7 and was inspired by the method described in \cite{SEM}. 
Neumann boundary conditions are used for all of the boundary types.

For each numerical solution presented in \sct{sec:results}, the type of boundary conditions used 
will be specified. The artificial diffusion coefficient $D(\mathbf  U)$ is set to zero at the boundary of the computational 
domain so that the boundary term 
$\int_{\partial \Omega} D(\mathbf  U) \grad \mathbf  U \cdot \vec{n} \, \mathbf W$ stemming from the 
integration by parts of the artificial dissipative terms in \eqt{eq:cfem} is ignored.
%
%---------------------------------------------------------------------------------------------------
\subsection{Solver} \label{sec:solver}
%---------------------------------------------------------------------------------------------------
%
A Jacobian-free-Newton-Krylov (JFNK) method is used to solve for the solution at the end of each time step. 
An approximate Jacobian matrix of the discretized equations was derived and implemented. Obtaining the 
matrix entries requires that the partial derivatives of pressure with respect to the conservative variables 
be known (this is relatively simple for the stiffened and ideal gas equations of state but may be more 
complex for general equations of state). The contributions of the artificial dissipative terms to the 
Jacobian matrix are approximated by lagging the viscosity coefficients (computing them with the previous solution). 
For instance, this is shown in \eqt{eq:jac_diss_term} for the dissipative terms present in the continuity equation:
\begin{equation}
\label{eq:jac_diss_term}
\frac{\partial}{\partial \mathbf U} \left( \kappa \div \rho \grad W \right) \simeq \kappa \frac{\partial}{\partial \mathbf U} \left( \div \rho \grad W \right),
\end{equation}  
where $\mathbf  U$ denotes any of the conservative variables and $W$ denotes the component of $\mathbf  W$ associated with the 
continuity equation. In the above, we have neglected $\frac{\partial \kappa}{\partial \mathbf U}$.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{$1$-D numerical results}\label{sec:results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
We now present two sample results of a single and a two-phase flow water-hammers in \sct{sec:single-num-res} and \sct{sec:two-num-res}, respectively, with the objective of testing adequacy of the Entropy Viscosity Method. The numerical results were obtained with the system code RELAP-7 that implements the single and two-phase flow models described in \sct{sct:model} using the \emph{Continuous Galerkin Finite Element Method} detailed in \sct{sec:spatial-disc} (BDF2 and linear test functions).

The water-hammer test case consists of a fluid or mixture flowing in a 1-D pipe of length $L=1$ m closed by two walls at $t=0$ s. A fluid is described by the Stiffened Gas equation of state \cite{SGEOS} with parameters taken from \cite{SEM} for the liquid and gas phases. The computational domain is discretized with an uniform mesh of $500$ cells and the numerical solution is run until $t = 0.5$ s with a CFL number of $0.5$ for both tests. Information regarding the initial conditions will be given later in this section. 
For each test case, the velocity, density and pressure profiles are provided at different times of the simulation. Since the Entropy Viscosity Method is used, we also give plots of the viscosity coefficients.
%
%---------------------------------------------------------------------------------------------------
\subsection{Single-phase water-hammer} \label{sec:single-num-res}
%---------------------------------------------------------------------------------------------------
%
A single-phase water-hammer consists of a liquid phase with initial uniform pressure ($P = 7$ MPa), velocity ($u = -12$ $m/s$ and temperature ($T = 453$ K). At $t=0$ s, the two extremities of the 1-D pipe are closed by solid walls which causes the pressure to increase and decrease at the left and right extremities, respectively. Numerical results of the pressure, density and velocity profiles are given in ...
%
%---------------------------------------------------------------------------------------------------
\subsection{Two-phase flow water-hammer} \label{sec:two-num-res}
%---------------------------------------------------------------------------------------------------
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions and future work}\label{sec:conclusion}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
We have presented an extension of the entropy viscosity method to the 1-D 7-equation two-phase model and applied it to a shock tube problem with large relaxation coefficients. The numerical results show that the stabilization method is capable of stabilizing the schemes and that the viscosity coefficients are well-scaled. This work will further contribute to the assessment of the stabilization technique for reactor flow problems in RELAP-7.
%
\bibliography{mybibfile}
\end{document}